<html>
<head>
  <link href='https://api.mapbox.com/mapbox-gl-js/v0.44.0/mapbox-gl.css' rel='stylesheet'/>
  <script src='https://api.mapbox.com/mapbox-gl-js/v0.44.0/mapbox-gl.js'></script>
  <title>Baremaps</title>
</head>
<body style="margin: 0">
<div id="map" style="width: 100%; height: 100%;"></div>
<script>

  // Initialize the map
  var map = new mapboxgl.Map({
    container: 'map',
    style: '/style.json',
    center: [9.5554, 47.1660],
    zoom: 15,
    minZoom: 14,
    maxZoom: 18
  });

  // Recenter the map according to the location saved in the url
  if (location.hash) {
    let arr = location.hash.substr(1).split("/");
    let zoom = parseFloat(arr[0]);
    let lng = parseFloat(arr[1]);
    let lat = parseFloat(arr[2]);
    map.setZoom(zoom);
    map.setCenter([lng, lat]);
  }

  // Changes the hash of the url when the location changes
  map.on('moveend', ev => {
    location.hash = `#${map.getZoom()}/${map.getCenter().lng}/${map.getCenter().lat}`;
  });

  // reload the webpage when this connection gets closed by the server
  fetch("/change/").catch(_ => setTimeout(() => location.reload(), 200));

</script>
</body>
</html>